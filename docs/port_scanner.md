# Documentation technique de `Nmap`

## Introduction

La classe `Nmap` fournit une interface pour effectuer des scans de ports réseau avec la bibliothèque `python-nmap`. Elle permet de détecter le système d'exploitation de l'hôte, identifier les versions des services sur les ports ouverts, et rechercher des vulnérabilités connues associées à ces services.

## Installation

Installez `python-nmap` avant d'utiliser la classe `Nmap` :

```bash
pip install python-nmap
```

## Classe `Nmap`

### Méthodes

#### `__init__(self, host: str, ports: List[int])`

Initialise une instance de `Nmap`.

- **Arguments** :
  - `host` : Une chaîne représentant l'adresse IP ou le nom de domaine de l'hôte à scanner.
  - `ports` : Une liste d'entiers représentant les ports à scanner.

#### `get_os(self) -> List[Dict[str, str]]`

Récupère les meilleures estimations du système d'exploitation de l'hôte.

- **Retourne** :
  - Une liste de dictionnaires où chaque dictionnaire contient `name` (nom du système d'exploitation), `accuracy` (précision de l'estimation), `type`, `vendor`, `osfamily`, et `osgen`.

#### `get_service_version(self, port: int) -> Optional[Dict[str, str]]`

Obtient la version du service pour un port donné.

- **Arguments** :
  - `port` : Le port pour lequel récupérer les informations.
- **Retourne** :
  - Un dictionnaire contenant `port`, `service`, et `version` si disponibles, `None` sinon.

#### `get_cves(self, port: int) -> List[Dict[str, Optional[str]]]`

Recherche des vulnérabilités (CVEs) pour un port donné.

- **Arguments** :
  - `port` : Le port pour lequel récupérer les CVEs.
- **Retourne** :
  - Une liste de dictionnaires, chaque dictionnaire contenant `id` (l'identifiant du CVE) et `url` (l'URL de référence, si disponible).

### Gestion des exceptions

#### `PortScannerError`

Cette exception personnalisée est levée en cas d'erreur lors du scan. Elle peut être capturée et gérée comme suit :

```python
try:
    nmap_scan = Nmap(host, ports)
    # Utilisations de nmap_scan
except PortScannerError as e:
    print(f"Erreur lors du scan: {e}")
```

## Exemple d'utilisation

Voici un exemple simple d'utilisation de la classe `Nmap` pour scanner un hôte :

```python
if __name__ == "__main__":
    ports = [21, 22, 80]
    host = "192.168.1.5"

    try:
        print("Nmap scan will start, please wait!")
        nmap_scan = Nmap(host, ports)
        os_info = nmap_scan.get_os()
        if os_info:
            for os_estimation in os_info:
                print(
                    f"OS Estimation: {os_estimation['name']} (Accuracy: {os_estimation['accuracy']}%)"
                )
                if "type" in os_estimation:
                    print(
                        f"  Type: {os_estimation['type']}, Vendor: {os_estimation['vendor']}, OS Family: {os_estimation['osfamily']}, OS Generation: {os_estimation['osgen']}"
                    )
        else:
            print("OS detection not available")

        for port in ports:
            service_info = nmap_scan.get_service_version(port)
            if service_info:
                print(
                    f"Service Information for port {port}: {service_info.get('service')}, Version: {service_info.get('version')}"
                )
            else:
                print(f"No service version information available for port {port}")

            cves = nmap_scan.get_cves(port)
            if cves:
                print(f"CVEs for port {port}:")
                for cve in cves:
                    print(f"  {cve['id']}")
                    if cve["url"]:
                        print(f"    URL: {cve['url']}")
            else:
                print(f"No CVEs found for port {port}.")

    except PortScannerError as error:
        print(error)
```

## Conclusion

La classe `Nmap` est un outil puissant pour les scans de réseau, offrant des fonctionnalités étendues pour la détection d'OS, l'identification de versions de services et la recherche de vulnérabilités. Assurez-vous de l'utiliser de manière responsable et conforme aux lois applicables.
