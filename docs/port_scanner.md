# Documentation technique de `Nmap`

## Introduction

La classe `Nmap` fournit une interface pour effectuer des scans de ports réseau avec la bibliothèque `python-nmap`. Elle permet de détecter le système d'exploitation de l'hôte, identifier les versions des services sur les ports ouverts, et rechercher des vulnérabilités connues associées à ces services.

## Installation

Installez `python-nmap` avant d'utiliser la classe `Nmap` :

```bash
pip install python-nmap
```

## Classe `Nmap`

### Méthodes

#### `__init__(self, host: str, ports: List[int])`

Initialise une instance de `Nmap`.

- **Arguments** :
  - `host` : Une chaîne représentant l'adresse IP ou le nom de domaine de l'hôte à scanner.
  - `ports` : Une liste d'entiers représentant les ports à scanner.

Votre documentation pour les méthodes de la classe `Nmap` est claire et bien structurée. Elle décrit de manière concise l'objectif et l'utilisation de chaque méthode, ainsi que les types d'entrée et de sortie attendus. Voici la documentation pour la méthode manquante `get_hostnames`, complétant ainsi les informations nécessaires pour utiliser pleinement la classe `Nmap`.

#### `get_hostnames(self) -> List[str]`

Récupère les noms d'hôte associés aux adresses IP scannées.

- **Retourne** :
  - Une liste de chaînes de caractères contenant les noms d'hôte trouvés lors du scan. Si aucun nom d'hôte n'est trouvé, retourne une liste vide.

Pour refléter correctement la capacité de la méthode `get_os` à fournir toutes les estimations du système d'exploitation pour tous les hôtes scannés, voici comment vous pourriez documenter cette méthode :

#### `get_os(self) -> List[Dict[str, str]]`

Récupère les meilleures estimations des systèmes d'exploitation pour tous les hôtes scannés, en fournissant des détails pour chaque adresse IP scannée.

- **Retourne** :
  - Une liste de dictionnaires, où chaque dictionnaire contient des informations détaillées sur une estimation du système d'exploitation, y compris :
    - `name` : Le nom du système d'exploitation estimé.
    - `accuracy` : La précision de l'estimation, en pourcentage.
    - `ip` : L'adresse IP de l'hôte pour lequel l'estimation est faite.
    - `type` : Le type de système d'exploitation (par exemple, "general purpose").
    - `vendor` : Le fournisseur du système d'exploitation (par exemple, "Linux").
    - `osfamily` : La famille du système d'exploitation (par exemple, "Linux").
    - `osgen` : La génération du système d'exploitation (par exemple, "2.6.X").

#### `get_service_version(self, port: int) -> Optional[Dict[str, str]]`

Obtient la version du service pour un port donné.

- **Arguments** :
  - `port` : Le port pour lequel récupérer les informations.
- **Retourne** :
  - Un dictionnaire contenant `port`, `service`, et `version` si disponibles, `None` sinon.

#### `get_cves(self, port: int) -> List[Dict[str, Optional[str]]]`

Recherche des vulnérabilités (CVEs) pour un port donné.

- **Arguments** :
  - `port` : Le port pour lequel récupérer les CVEs.
- **Retourne** :
  - Une liste de dictionnaires, chaque dictionnaire contenant `id` (l'identifiant du CVE) et `url` (l'URL de référence, si disponible).

### Gestion des exceptions

#### `PortScannerError`

Cette exception personnalisée est levée en cas d'erreur lors du scan. Elle peut être capturée et gérée comme suit :

```python
try:
    nmap_scan = Nmap(host, ports)
    # Utilisations de nmap_scan
except PortScannerError as e:
    print(f"Erreur lors du scan: {e}")
```

## Exemple d'utilisation

Voici un exemple simple d'utilisation de la classe `Nmap` pour scanner un hôte :

```python
if __name__ == "__main__":
    ports = [21, 22, 80]
    host = "balgogan-kerago.eu"

    try:
        print("Nmap scan will start, please wait!")
        nmap_scan = port_scanner.Nmap(host, ports)
        # print(nmap_scan.scanner._scan_result) Debug purpose
        
        hostnames = nmap_scan.get_hostnames()
        if hostnames:
            print(f"Hostnames for {host}: {', '.join(hostnames)}")
        else:
            print(f"No hostnames found for {host}")
        print()
        
        os_info = nmap_scan.get_os()
        if os_info:
            for os_estimation in os_info:
                print(
                    f"OS Estimation: {os_estimation['name']} (Accuracy: {os_estimation['accuracy']}%)"
                )
                if "type" in os_estimation:
                    print(
                        f"  Type: {os_estimation['type']}, Vendor: {os_estimation['vendor']}, OS Family: {os_estimation['osfamily']}, OS Generation: {os_estimation['osgen']}"
                    )
        else:
            print("OS detection not available")

        print()
        for port in ports:
            service_info = nmap_scan.get_service_version(port)
            if service_info:
                print(
                    f"Service Information for port {port}: {service_info.get('service')}, Version: {service_info.get('version')}"
                )
            else:
                print(f"No service version information available for port {port}")

            cves = nmap_scan.get_cves(port)
            if cves:
                print(f"CVEs for port {port}:")
                for cve in cves:
                    print(f"  {cve['id']}")
                    if cve["url"]:
                        print(f"    URL: {cve['url']}")
            else:
                print(f"No CVEs found for port {port}.")
            print()

    except port_scanner.PortScannerError as error:
        print(error)
```

## Conclusion

La classe `Nmap` est un outil puissant pour les scans de réseau, offrant des fonctionnalités étendues pour la détection d'OS, l'identification de versions de services et la recherche de vulnérabilités. Assurez-vous de l'utiliser de manière responsable et conforme aux lois applicables.
